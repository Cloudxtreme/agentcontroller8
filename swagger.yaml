swagger: '2.0'

info:
  title: AgentController2
  description: JumpScale Agent Controller 2
  version: 1.0.0  # This spec is actually not versioned

schemes:
  - https

basePath: /

produces:
  - application/json

paths:

  '/{gid}/{nid}/cmd':
    get:
      summary: Poll for a command
      parameters:
        - $ref: "#/parameters/gid"
        - $ref: "#/parameters/nid"
        - name: roles
          in: query
          description: Self-assigned roles of Agent
          required: true
          type: array
          items:
            type: string
      responses:
        '200':
          description: The execute command JSON request
        default:
          description: Unexpected error

  '/{gid}/{nid}/logs':
    post:
      summary: Post Agent log to Controller
      parameters:
        - $ref: "#/parameters/gid"
        - $ref: "#/parameters/nid"
      responses:
        '200':
          description: Success
        default:
          description: Unexpected error

  '/{gid}/{nid}/result':
    post:
      summary: Post execution result from Agent to Controller
      parameters:
        - $ref: "#/parameters/gid"
        - $ref: "#/parameters/nid"
        - $ref: "#/parameters/jid"
      responses:
        '200':
          description: Success
        default:
          description: Unexpected error

  '/{gid}/{nid}/stats':
    post:
      summary: Post stats which will be saved in influxdb
      parameters:
        - $ref: "#/parameters/gid"
        - $ref: "#/parameters/nid"
      responses:
        '200':
          description: Success
        default:
          description: Unexpected error

parameters:
  gid:
    name: gid
    in: path
    description: Grid ID
    required: true
    type: integer
    format: integer
  nid:
    name: nid
    in: path
    description: Node ID
    required: true
    type: integer
    format: integer
  jid:
    name: jid
    in: query
    description: Job
    required: true
    type: integer
    format: integer